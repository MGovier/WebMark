<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>WebMark by MGovier</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">WebMark</h1>
      <h2 class="project-tagline">Offline-first efficient and responsive online marking</h2>
      <a href="https://github.com/MGovier/WebMark" class="btn">View on GitHub</a>
      <a href="https://github.com/MGovier/WebMark/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/MGovier/WebMark/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="webmark" class="anchor" href="#webmark" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>WebMark</h1>

<p>A Meteor powered offline-first Web Application to enable efficient and flexible marking of assignments. Developed as a final year project for BSc Computer Science by Merlin Govier (UP663652) at the University of Portsmouth, UK.</p>

<h2>
<a id="table-of-contents" class="anchor" href="#table-of-contents" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Table of Contents</h2>

<ul>
<li><a href="#user">User Guide</a></li>
<li><a href="#developer">Developer Guide</a></li>
<li><a href="#deployment">Deployment Guide</a></li>
<li><a href="#license">License</a></li>
</ul>

<h2>
<a id="user-guide" class="anchor" href="#user-guide" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>User Guide</h2>

<p>The <a href="https://mgovier.github.io/WebMark/user/">user guide</a> details how to use the application as an end-user.</p>

<h2>
<a id="developer-guide" class="anchor" href="#developer-guide" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Developer Guide</h2>

<ul>
<li>Install <a href="https://www.meteor.com/">Meteor</a>. Requires v1.3+.</li>
<li>Clone this repo, in your terminal <code>cd</code> into the root folder.</li>
<li>Run <code>meteor npm install</code> to install node dependencies, then <code>meteor</code> to locally serve the application.</li>
</ul>

<h3>
<a id="code-style--linting" class="anchor" href="#code-style--linting" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Code Style &amp; Linting</h3>

<p>This project aims to follow the <a href="http://guide.meteor.com/code-style.html">Meteor Guide Code Style</a>. Linting uses ESLint, with Airbnb's configuration. Run <code>meteor npm run lint</code> to check.</p>

<h3>
<a id="project-structure" class="anchor" href="#project-structure" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Project Structure</h3>

<table>
<thead>
<tr>
<th>Directory</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>lib/</td>
<td>Client and server shared functions, such as application routes and data schemas.</td>
</tr>
<tr>
<td>public/</td>
<td>Files to serve directly to client, such as favicon.ico or robots.txt.</td>
</tr>
<tr>
<td>server/</td>
<td>Code to only execute on the server only. This holds security configurations.</td>
</tr>
<tr>
<td>client/</td>
<td>Client side code; including interface functions and CSS. Contains:</td>
</tr>
<tr>
<td></td>
<td>
<strong>templates/</strong>    : Contains HTML partials for use in the interface.</td>
</tr>
<tr>
<td></td>
<td>
<strong>compatibility/</strong>  : Modules that rely on exporting global objects.</td>
</tr>
<tr>
<td></td>
<td>
<strong>lib/</strong>         : SCSS components and reused JS functions.</td>
</tr>
<tr>
<td></td>
<td>
<strong>controllers/</strong> : JS functionality.</td>
</tr>
<tr>
<td>builds/</td>
<td>Self-contained application bundles for production testing and deployment.</td>
</tr>
</tbody>
</table>

<h2>
<a id="deployment" class="anchor" href="#deployment" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Deployment</h2>

<p>The application utilizes a Node.JS powered server, connected to MongoDB and running behind a reverse proxy TLS terminator.</p>

<p>The most recent versions tested successfully are shown below:</p>

<table>
<thead>
<tr>
<th>Requirement</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://nodejs.org/en/">Node.JS</a></td>
<td>0.10.44</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/">MongoDB</a></td>
<td>3.2</td>
</tr>
<tr>
<td><a href="http://nginx.org/en/">Nginx</a></td>
<td>1.9.14</td>
</tr>
</tbody>
</table>

<p>As of 1.3.1, Meteor requires the 0.10 Node.JS branch, but this may change in future releases. The most recent versions of other technologies should be compatible. Other reverse proxies can be used in place of Nginx, such as HAProxy.</p>

<h3>
<a id="nodejs-server" class="anchor" href="#nodejs-server" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Node.JS Server</h3>

<p>Meteor can produce a self-contained NodeJS bundle. To generate this, use <code>meteor build</code> from inside the project directory. If you will be deploying onto a different platform than that which you are currently on, specify which with the <code>--architecture</code> flag.</p>

<p>Environment variables are required for the Meteor application:</p>

<table>
<thead>
<tr>
<th>Variable</th>
<th>Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td>ROOT_URL</td>
<td>The domain path for the application, such as <code>https://example.com/marking</code>.</td>
</tr>
<tr>
<td>HTTP_FORWARDED_COUNT</td>
<td>Number of reverse proxies deployed in front of Node.JS - i.e. <code>1</code>.</td>
</tr>
<tr>
<td>PORT</td>
<td>Port to listen to. This should match the reverse proxy's expected local address, such as 3000.</td>
</tr>
<tr>
<td>NODE_ENV</td>
<td>Set for npm modules. Use <code>production</code> for running in production.</td>
</tr>
<tr>
<td>MONGO_URL</td>
<td>Address for the MongoDB server. Follows pattern <code>mongodb://user:password@host:port/databasename</code>.</td>
</tr>
</tbody>
</table>

<h3>
<a id="mongodb" class="anchor" href="#mongodb" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MongoDB</h3>

<p>Ensure MongoDB can only be accessed locally, and set suitable users with restricted roles.</p>

<h3>
<a id="reverse-proxy--security" class="anchor" href="#reverse-proxy--security" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Reverse Proxy &amp; Security</h3>

<p>If using Nginx, a good configuration for the TLS terminator can be sourced from the <a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/">Mozilla SSL Configuration Generator</a> and following <a href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html">Remy van Elst's Nginx Security Advice</a>. This requires a stronger Diffie-Hellman parameter than the default, which can be generated using</p>

<pre><code>cd /etc/ssl/certs
openssl dhparam -out dhparam.pem 4096
</code></pre>

<p>The reverse proxy needs to provide some HTTP headers for the Node.JS server. These are:</p>

<pre><code>proxy_set_header X-Real-IP $remote_addr;  # http://wiki.nginx.org/HttpProxyModule
proxy_set_header Host $host;  # pass the host header - http://wiki.nginx.org/HttpProxyModule#proxy_pass
proxy_http_version 1.1;  # recommended with keepalive connections - http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_http_version
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
# WebSocket proxying - from http://nginx.org/en/docs/http/websocket.html
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection 'upgrade';
</code></pre>

<p><a href="https://gist.github.com/MGovier/5112025ec482012163c6d563dd75ca32">This Gist</a> shows the configuration used for production testing, and features redirects from both <code>http</code> and <code>www.</code> to <code>https</code> and <code>non-www.</code>.</p>

<p>Direct internet/public access to the Node.JS or MongoDB services should be prevented, potentially through firewall configuration.</p>

<h3>
<a id="docker" class="anchor" href="#docker" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Docker</h3>

<p>The services can be managed using Docker and Docker Compose. Nginx can be configured as above, and an example configuration for the Node.JS server is:</p>

<h4>
<a id="dockerfile" class="anchor" href="#dockerfile" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dockerfile</h4>

<pre><code>FROM node:0.10
ENV ROOT_URL="https://example.me"
ENV HTTP_FORWARDED_COUNT=1
ENV PORT=3000
ENV NODE_ENV=production
ENV MONGO_URL="mongodb://user:pass@mongo:27017/WebMark"
EXPOSE 3000
ADD WebMark.tar.gz /WebMark/
RUN (cd WebMark/bundle/programs/server &amp;&amp; npm install)
</code></pre>

<h4>
<a id="start-script-run-sh-start" class="anchor" href="#start-script-run-sh-start" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Start script (run <code>sh start</code>)</h4>

<pre><code>docker rm -f webmark-host
docker build -t webmark-image .
docker run --name webmark-host --link mongo-host:mongo -p 127.0.0.1:3000:3000 --restart=always -d webmark-image node /WebMark/bundle/main.js
</code></pre>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<p>MIT</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/MGovier/WebMark">WebMark</a> is maintained by <a href="https://github.com/MGovier">MGovier</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
